Scope: 2 of 3 workspace projects
. test$ vitest --run
../api test$ cd ../.. && npx vitest run --config vitest.config.ts
. test:  RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/admin-ui
. test:  âœ“ src/__tests__/smoke.spec.ts  (1 test) 1ms
. test:  Test Files  1 passed (1)
. test:       Tests  1 passed (1)
. test:    Start at  03:45:06
. test:    Duration  241ms (transform 21ms, setup 0ms, collect 14ms, tests 1ms, environment 0ms, prepare 72ms)
. test: Done
../api test: [33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
../api test:  RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe
../api test:  âœ“ tests/formulas.spec.ts  (5 tests) 9ms
../api test: {"level":"debug","time":"2025-10-10T01:45:07.015Z","pid":2745,"workspaceId":"ws-1","msg":"Returning default settings (database skipped)"}
../api test:  âœ“ tests/formulaEngineSecurity.spec.ts  (10 tests) 15ms
../api test: {"level":"debug","time":"2025-10-10T01:45:07.017Z","pid":2745,"workspaceId":"ws-1","msg":"No settings found, returning defaults"}
../api test: {"level":"error","time":"2025-10-10T01:45:07.018Z","pid":2745,"err":{"type":"Error","message":"DB connection failed","stack":"Error: DB connection failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:122:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","msg":"Failed to fetch workspace settings"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.025Z","pid":2745,"workspaceId":"ws-1","patch":{"strict_mode":true,"reference_months":6},"msg":"Settings update skipped (database disabled)"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.026Z","pid":2745,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":8,"region":"euw2"},"msg":"Workspace settings updated"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.027Z","pid":2745,"workspaceId":"ws-1","updates":{"strict_mode":true},"msg":"Workspace settings updated"}
../api test: {"level":"error","time":"2025-10-10T01:45:07.027Z","pid":2745,"err":{"type":"Error","message":"DB write failed","stack":"Error: DB write failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:231:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","patch":{"strict_mode":true},"msg":"Failed to update workspace settings"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.028Z","pid":2745,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":4,"region":"euc1"},"msg":"Workspace settings updated"}
../api test:  âœ“ tests/settings.spec.ts  (12 tests) 16ms
../api test:  âœ“ tests/otRules.spec.ts  (9 tests) 4ms
../api test: {"level":"info","time":"2025-10-10T01:45:07.127Z","pid":2745,"env":"test","correlationId":"corr-1","entryId":"5f118c837db7a8637ffcaf36","updates":[{"customFieldId":"amount-field","fieldKey":"Amount","value":75}],"msg":"Applied custom field updates"}
../api test:  âœ“ tests/proxyController.spec.ts  (15 tests) 38ms
../api test:  âœ“ tests/webhook.spec.ts  (2 tests) 54ms
../api test: {"level":"info","time":"2025-10-10T01:45:07.147Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"c7929499-7ddc-4550-a1c4-0bec823661b0","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.147Z","pid":2745,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.147Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"warn","time":"2025-10-10T01:45:07.147Z","pid":2745,"retryAfterMs":1000,"attempt":1,"page":1,"date":"2024-01-01","msg":"Rate limited during reports API call, retrying"}
../api test: {"level":"info","time":"2025-10-10T01:45:08.147Z","pid":2745,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:08.147Z","pid":2745,"result":{"scanned":1,"updated":0,"dryRun":true,"days":1},"correlationId":"c7929499-7ddc-4550-a1c4-0bec823661b0","msg":"Backfill operation completed"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.153Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"23156d46-b613-4fdf-a053-e8c02639a5d2","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.153Z","pid":2745,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.153Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"warn","time":"2025-10-10T01:45:07.153Z","pid":2745,"entryId":"entry-1","retryAfterMs":1000,"attempt":1,"msg":"Rate limited during backfill patch, retrying"}
../api test: {"level":"info","time":"2025-10-10T01:45:08.153Z","pid":2745,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:08.153Z","pid":2745,"result":{"scanned":1,"updated":1,"dryRun":false,"days":1},"correlationId":"23156d46-b613-4fdf-a053-e8c02639a5d2","msg":"Backfill operation completed"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.157Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"34d9addd-e480-42b4-9dc3-1dea590063cc","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.157Z","pid":2745,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.157Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-01","scanned":250,"updated":0,"errors":0,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"result":{"scanned":250,"updated":0,"dryRun":true,"days":1},"correlationId":"34d9addd-e480-42b4-9dc3-1dea590063cc","msg":"Backfill operation completed"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-03T23:59:59Z","dryRun":true},"correlationId":"32c81779-5469-4051-b98c-eda46f9f96cd","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"dayCount":3,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-03T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-02","dayStart":"2024-01-02T00:00:00Z","dayEnd":"2024-01-02T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-02","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-03","dayStart":"2024-01-03T00:00:00Z","dayEnd":"2024-01-03T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.160Z","pid":2745,"date":"2024-01-03","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"result":{"scanned":3,"updated":0,"dryRun":true,"days":3},"correlationId":"32c81779-5469-4051-b98c-eda46f9f96cd","msg":"Backfill operation completed"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"1304f263-8fc4-414a-9ed4-d70708b9a388","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.161Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"result":{"scanned":1,"updated":1,"dryRun":true,"days":1},"correlationId":"1304f263-8fc4-414a-9ed4-d70708b9a388","msg":"Backfill operation completed"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"2df927c5-cd8c-4812-af51-a1b2f4f5da02","workspaceId":"test-workspace","msg":"Starting backfill operation"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.161Z","pid":2745,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
../api test: {"level":"debug","time":"2025-10-10T01:45:07.161Z","pid":2745,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
../api test: {"level":"error","time":"2025-10-10T01:45:07.161Z","pid":2745,"err":{"type":"Error","message":"Network error","stack":"Error: Network error\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/backfill.spec.ts:223:55\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7\n    at withEnv (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)"},"entryId":"entry-1","correlationId":"2df927c5-cd8c-4812-af51-a1b2f4f5da02-day-2024-01-01-page-1-entry-1","msg":"Failed to process entry during backfill"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.168Z","pid":2745,"date":"2024-01-01","scanned":1,"updated":0,"errors":1,"msg":"Completed day window"}
../api test: {"level":"info","time":"2025-10-10T01:45:07.168Z","pid":2745,"result":{"scanned":1,"updated":0,"dryRun":false,"days":1},"correlationId":"2df927c5-cd8c-4812-af51-a1b2f4f5da02","msg":"Backfill operation completed"}
../api test:  âœ“ tests/backfill.spec.ts  (6 tests) 26ms
../api test:  âœ“ tests/webhookSecurity.spec.ts  (8 tests) 7ms
../api test: stdout | tests/sidebarToken.spec.ts > Sidebar token refresh (JSDOM) > updates token and refetches on addonTokenRefreshed
../api test: Token refreshed successfully
../api test: stderr | tests/sidebarToken.spec.ts > Sidebar token refresh (JSDOM) > shows error badge on refreshAddonTokenFailed
../api test: Token refresh failed
../api test:  âœ“ tests/sidebarToken.spec.ts  (3 tests) 91ms
../api test:  Test Files  9 passed (9)
../api test:       Tests  70 passed (70)
../api test:    Start at  03:45:06
../api test:    Duration  1.06s (transform 627ms, setup 108ms, collect 1.24s, tests 260ms, environment 389ms, prepare 1.02s)
../api test: Done
