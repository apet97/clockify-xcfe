
> clockify-xcfe@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe
> pnpm --filter @xcfe/api test && pnpm --filter @xcfe/admin-ui test


> @xcfe/api@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/api
> cd ../.. && npx vitest run --config vitest.config.ts

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe

 âœ“ tests/formulas.spec.ts  (5 tests) 7ms
{"level":"debug","time":"2025-10-10T16:49:30.008Z","pid":19003,"workspaceId":"ws-1","msg":"Returning default settings (database skipped)"}
 âœ“ tests/formulaEngineSecurity.spec.ts  (10 tests) 13ms
{"level":"debug","time":"2025-10-10T16:49:30.010Z","pid":19003,"workspaceId":"ws-1","msg":"No settings found, returning defaults"}
{"level":"error","time":"2025-10-10T16:49:30.010Z","pid":19003,"err":{"type":"Error","message":"DB connection failed","stack":"Error: DB connection failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:122:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","msg":"Failed to fetch workspace settings"}
{"level":"debug","time":"2025-10-10T16:49:30.015Z","pid":19003,"workspaceId":"ws-1","patch":{"strict_mode":true,"reference_months":6},"msg":"Settings update skipped (database disabled)"}
{"level":"info","time":"2025-10-10T16:49:30.016Z","pid":19003,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":8,"region":"euw2"},"msg":"Workspace settings updated"}
{"level":"info","time":"2025-10-10T16:49:30.016Z","pid":19003,"workspaceId":"ws-1","updates":{"strict_mode":true},"msg":"Workspace settings updated"}
{"level":"error","time":"2025-10-10T16:49:30.017Z","pid":19003,"err":{"type":"Error","message":"DB write failed","stack":"Error: DB write failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:231:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","patch":{"strict_mode":true},"msg":"Failed to update workspace settings"}
{"level":"info","time":"2025-10-10T16:49:30.018Z","pid":19003,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":4,"region":"euc1"},"msg":"Workspace settings updated"}
 âœ“ tests/settings.spec.ts  (12 tests) 14ms
 âœ“ tests/otRules.spec.ts  (9 tests) 4ms
{"level":"info","time":"2025-10-10T16:49:30.061Z","pid":19003,"env":"test","correlationId":"corr-1","entryId":"5f118c837db7a8637ffcaf36","updates":[{"customFieldId":"amount-field","fieldKey":"Amount","value":75}],"msg":"Applied custom field updates"}
 âœ“ tests/webhook.spec.ts  (2 tests) 25ms
{"level":"info","time":"2025-10-10T16:49:30.101Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"7510c891-0865-4928-bfc3-488104077b3d","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.101Z","pid":19003,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.101Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"warn","time":"2025-10-10T16:49:30.101Z","pid":19003,"retryAfterMs":1000,"attempt":1,"page":1,"date":"2024-01-01","msg":"Rate limited during reports API call, retrying"}
{"level":"info","time":"2025-10-10T16:49:31.101Z","pid":19003,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:31.101Z","pid":19003,"result":{"scanned":1,"updated":0,"dryRun":true,"days":1},"correlationId":"7510c891-0865-4928-bfc3-488104077b3d","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-10T16:49:30.106Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"68833481-33df-4841-8531-39ec0f1d880b","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.106Z","pid":19003,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.106Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"warn","time":"2025-10-10T16:49:30.106Z","pid":19003,"entryId":"entry-1","retryAfterMs":1000,"attempt":1,"msg":"Rate limited during backfill patch, retrying"}
{"level":"info","time":"2025-10-10T16:49:31.106Z","pid":19003,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:31.106Z","pid":19003,"result":{"scanned":1,"updated":1,"dryRun":false,"days":1},"correlationId":"68833481-33df-4841-8531-39ec0f1d880b","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-10T16:49:30.112Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"b1be4ebf-cf02-4617-aa9e-121ea212d509","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.112Z","pid":19003,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.112Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-10T16:49:30.114Z","pid":19003,"date":"2024-01-01","scanned":250,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:30.114Z","pid":19003,"result":{"scanned":250,"updated":0,"dryRun":true,"days":1},"correlationId":"b1be4ebf-cf02-4617-aa9e-121ea212d509","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-03T23:59:59Z","dryRun":true},"correlationId":"e3bf8e1d-037a-4190-894b-6cdd7229257b","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"dayCount":3,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-03T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"debug","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-02","dayStart":"2024-01-02T00:00:00Z","dayEnd":"2024-01-02T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-02","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"debug","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-03","dayStart":"2024-01-03T00:00:00Z","dayEnd":"2024-01-03T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"date":"2024-01-03","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:30.115Z","pid":19003,"result":{"scanned":3,"updated":0,"dryRun":true,"days":3},"correlationId":"e3bf8e1d-037a-4190-894b-6cdd7229257b","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"abc92619-50f5-4025-8128-5f90ba7d70c2","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.116Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"result":{"scanned":1,"updated":1,"dryRun":true,"days":1},"correlationId":"abc92619-50f5-4025-8128-5f90ba7d70c2","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"a01c045e-ba39-4edc-89d4-9868046625da","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-10T16:49:30.116Z","pid":19003,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-10T16:49:30.116Z","pid":19003,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"error","time":"2025-10-10T16:49:30.116Z","pid":19003,"err":{"type":"Error","message":"Network error","stack":"Error: Network error\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/backfill.spec.ts:223:55\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7\n    at withEnv (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19_jsdom@24.1.3/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)"},"entryId":"entry-1","correlationId":"a01c045e-ba39-4edc-89d4-9868046625da-day-2024-01-01-page-1-entry-1","msg":"Failed to process entry during backfill"}
{"level":"info","time":"2025-10-10T16:49:30.119Z","pid":19003,"date":"2024-01-01","scanned":1,"updated":0,"errors":1,"msg":"Completed day window"}
{"level":"info","time":"2025-10-10T16:49:30.119Z","pid":19003,"result":{"scanned":1,"updated":0,"dryRun":false,"days":1},"correlationId":"a01c045e-ba39-4edc-89d4-9868046625da","msg":"Backfill operation completed"}
 âœ“ tests/backfill.spec.ts  (6 tests) 19ms
 âœ“ tests/proxyController.spec.ts  (15 tests) 28ms
 âœ“ tests/webhookSecurity.spec.ts  (8 tests) 4ms
stdout | tests/sidebarToken.spec.ts > Sidebar token refresh (JSDOM) > updates token and refetches on addonTokenRefreshed
Token refreshed successfully

stderr | tests/sidebarToken.spec.ts > Sidebar token refresh (JSDOM) > shows error badge on refreshAddonTokenFailed
Token refresh failed

 âœ“ tests/sidebarToken.spec.ts  (3 tests) 79ms

 Test Files  9 passed (9)
      Tests  70 passed (70)
   Start at  18:49:29
   Duration  1.03s (transform 597ms, setup 96ms, collect 1.13s, tests 193ms, environment 372ms, prepare 1.02s)


> @xcfe/admin-ui@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/admin-ui
> vitest --run


 RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/admin-ui

 âœ“ src/__tests__/smoke.spec.ts  (1 test) 1ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  18:49:31
   Duration  226ms (transform 22ms, setup 0ms, collect 11ms, tests 1ms, environment 0ms, prepare 67ms)

