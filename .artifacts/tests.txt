
> clockify-xcfe@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe
> pnpm --filter @xcfe/api test && pnpm --filter @xcfe/admin-ui test


> @xcfe/api@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/api
> cd ../.. && npx vitest run --config vitest.config.ts

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe

 âœ“ tests/webhookSecurity.spec.ts  (8 tests) 5ms
 âœ“ tests/formulas.spec.ts  (5 tests) 9ms
{"level":"debug","time":"2025-10-09T01:10:53.135Z","pid":17565,"workspaceId":"ws-1","msg":"Returning default settings (database skipped)"}
 âœ“ tests/formulaEngineSecurity.spec.ts  (10 tests) 14ms
{"level":"debug","time":"2025-10-09T01:10:53.137Z","pid":17565,"workspaceId":"ws-1","msg":"No settings found, returning defaults"}
{"level":"error","time":"2025-10-09T01:10:53.137Z","pid":17565,"err":{"type":"Error","message":"DB connection failed","stack":"Error: DB connection failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:122:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","msg":"Failed to fetch workspace settings"}
{"level":"debug","time":"2025-10-09T01:10:53.142Z","pid":17565,"workspaceId":"ws-1","patch":{"strict_mode":true,"reference_months":6},"msg":"Settings update skipped (database disabled)"}
{"level":"info","time":"2025-10-09T01:10:53.143Z","pid":17565,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":8,"region":"euw2"},"msg":"Workspace settings updated"}
{"level":"info","time":"2025-10-09T01:10:53.148Z","pid":17565,"workspaceId":"ws-1","updates":{"strict_mode":true},"msg":"Workspace settings updated"}
{"level":"error","time":"2025-10-09T01:10:53.149Z","pid":17565,"err":{"type":"Error","message":"DB write failed","stack":"Error: DB write failed\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/settings.spec.ts:231:35\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7"},"workspaceId":"ws-1","patch":{"strict_mode":true},"msg":"Failed to update workspace settings"}
{"level":"info","time":"2025-10-09T01:10:53.149Z","pid":17565,"workspaceId":"ws-1","updates":{"strict_mode":true,"reference_months":4,"region":"euc1"},"msg":"Workspace settings updated"}
 âœ“ tests/settings.spec.ts  (12 tests) 16ms
 âœ“ tests/otRules.spec.ts  (9 tests) 9ms
{"level":"info","time":"2025-10-09T01:10:53.219Z","pid":17565,"env":"test","correlationId":"corr-1","entryId":"5f118c837db7a8637ffcaf36","updates":[{"customFieldId":"amount-field","fieldKey":"Amount","value":75}],"msg":"Applied custom field updates"}
 âœ“ tests/webhook.spec.ts  (2 tests) 25ms
{"level":"info","time":"2025-10-09T01:10:53.281Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"5407ef40-8f41-4720-b1f3-1e11947e2310","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.281Z","pid":17565,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.281Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"warn","time":"2025-10-09T01:10:53.281Z","pid":17565,"retryAfterMs":1000,"attempt":1,"page":1,"date":"2024-01-01","msg":"Rate limited during reports API call, retrying"}
{"level":"info","time":"2025-10-09T01:10:54.281Z","pid":17565,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:54.281Z","pid":17565,"result":{"scanned":1,"updated":0,"dryRun":true,"days":1},"correlationId":"5407ef40-8f41-4720-b1f3-1e11947e2310","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-09T01:10:53.284Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"9acc6ba9-b679-4371-9b93-16073ef63b3e","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.284Z","pid":17565,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.284Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"warn","time":"2025-10-09T01:10:53.284Z","pid":17565,"entryId":"entry-1","retryAfterMs":1000,"attempt":1,"msg":"Rate limited during backfill patch, retrying"}
{"level":"info","time":"2025-10-09T01:10:54.284Z","pid":17565,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:54.284Z","pid":17565,"result":{"scanned":1,"updated":1,"dryRun":false,"days":1},"correlationId":"9acc6ba9-b679-4371-9b93-16073ef63b3e","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-09T01:10:53.286Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"f3a4ef91-508d-4c5a-aee5-d24397b2d58c","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.286Z","pid":17565,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.286Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-09T01:10:53.288Z","pid":17565,"date":"2024-01-01","scanned":250,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:53.288Z","pid":17565,"result":{"scanned":250,"updated":0,"dryRun":true,"days":1},"correlationId":"f3a4ef91-508d-4c5a-aee5-d24397b2d58c","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-03T23:59:59Z","dryRun":true},"correlationId":"709bb2d9-a3ad-468d-84ed-6d8b97806c6d","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"dayCount":3,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-03T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-01","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"debug","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-02","dayStart":"2024-01-02T00:00:00Z","dayEnd":"2024-01-02T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-02","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"debug","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-03","dayStart":"2024-01-03T00:00:00Z","dayEnd":"2024-01-03T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-03","scanned":1,"updated":0,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"result":{"scanned":3,"updated":0,"dryRun":true,"days":3},"correlationId":"709bb2d9-a3ad-468d-84ed-6d8b97806c6d","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":true},"correlationId":"9cd26221-f13d-4faf-a263-5ee8bbc09dd5","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"date":"2024-01-01","scanned":1,"updated":1,"errors":0,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:53.289Z","pid":17565,"result":{"scanned":1,"updated":1,"dryRun":true,"days":1},"correlationId":"9cd26221-f13d-4faf-a263-5ee8bbc09dd5","msg":"Backfill operation completed"}
{"level":"info","time":"2025-10-09T01:10:53.290Z","pid":17565,"params":{"from":"2024-01-01T00:00:00Z","to":"2024-01-01T23:59:59Z","dryRun":false},"correlationId":"e3a8c6a8-5253-414c-9735-60668dd1861c","workspaceId":"test-workspace","msg":"Starting backfill operation"}
{"level":"info","time":"2025-10-09T01:10:53.290Z","pid":17565,"dayCount":1,"startDate":"2024-01-01T00:00:00.000Z","endDate":"2024-01-01T23:59:59.000Z","msg":"Processing backfill by daily windows"}
{"level":"debug","time":"2025-10-09T01:10:53.290Z","pid":17565,"date":"2024-01-01","dayStart":"2024-01-01T00:00:00Z","dayEnd":"2024-01-01T23:59:59Z","msg":"Processing day window"}
{"level":"error","time":"2025-10-09T01:10:53.290Z","pid":17565,"err":{"type":"Error","message":"Network error","stack":"Error: Network error\n    at /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/tests/backfill.spec.ts:223:55\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:135:14\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:60:26\n    at runTest (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:17)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)\n    at file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7\n    at withEnv (file:///Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.19/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)"},"entryId":"entry-1","correlationId":"e3a8c6a8-5253-414c-9735-60668dd1861c-day-2024-01-01-page-1-entry-1","msg":"Failed to process entry during backfill"}
{"level":"info","time":"2025-10-09T01:10:53.292Z","pid":17565,"date":"2024-01-01","scanned":1,"updated":0,"errors":1,"msg":"Completed day window"}
{"level":"info","time":"2025-10-09T01:10:53.292Z","pid":17565,"result":{"scanned":1,"updated":0,"dryRun":false,"days":1},"correlationId":"e3a8c6a8-5253-414c-9735-60668dd1861c","msg":"Backfill operation completed"}
 âœ“ tests/backfill.spec.ts  (6 tests) 12ms

 Test Files  7 passed (7)
      Tests  52 passed (52)
   Start at  03:10:52
   Duration  540ms (transform 417ms, setup 105ms, collect 929ms, tests 90ms, environment 1ms, prepare 834ms)


> @xcfe/admin-ui@0.1.0 test /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/admin-ui
> vitest --run


 RUN  v1.6.1 /Users/15x/Downloads/xCustomFieldExpander/clockify-xcfe/apps/admin-ui

 âœ“ src/__tests__/smoke.spec.ts  (1 test) 2ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  03:10:53
   Duration  210ms (transform 23ms, setup 0ms, collect 11ms, tests 2ms, environment 0ms, prepare 63ms)

